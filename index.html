<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG from markup</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const App = () => {
            const [inputValue, setInputValue] = React.useState('');
            const [svgContent, setSvgContent] = React.useState('');
            const [error, setError] = React.useState('');

            const extractSVG = (input) => {
                try {
                    let svg = '';
                    
                    // Check for background-image URL format
                    const urlMatch = input.match(/background-image:\s*url\(&quot;data:image\/svg\+xml;utf8,(.*?)&quot;\)/);
                    if (urlMatch) {
                        svg = decodeURIComponent(urlMatch[1]);
                    } else {
                        // Look for raw SVG tags
                        const svgMatch = input.match(/<svg[\s\S]*?<\/svg>/);
                        if (svgMatch) {
                            svg = svgMatch[0];
                        }
                    }

                    if (!svg) {
                        throw new Error('No valid SVG found in input');
                    }

                    // Clean up any encoded entities
                    svg = svg.replace(/&quot;/g, '"')
                           .replace(/&lt;/g, '<')
                           .replace(/&gt;/g, '>')
                           .replace(/&amp;/g, '&');

                    return svg;
                } catch (err) {
                    setError('Invalid input format. Please paste content containing an SVG element or background.');
                    return null;
                }
            };

            const handleInputChange = (e) => {
                setInputValue(e.target.value);
                setError('');
                
                const extracted = extractSVG(e.target.value);
                if (extracted) {
                    setSvgContent(extracted);
                    setError('');
                }
            };

            const handleDownload = () => {
                if (!svgContent) return;
                
                const blob = new Blob([svgContent], { type: 'image/svg+xml;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'icon.svg';
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
            };

            // Download icon SVG
            const DownloadIcon = () => (
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
            );

            return (
                <div className="p-6 space-y-6 max-w-3xl mx-auto">
                    <h1 className="text-2xl font-bold text-gray-900">SVG from markup</h1>
                    
                    {/* Input Area */}
                    <div className="space-y-2">
                        <label className="block text-sm font-medium text-gray-700">
                            Paste markup containing SVG (div with background-image or raw SVG)
                        </label>
                        <textarea
                            value={inputValue}
                            onChange={handleInputChange}
                            className="w-full h-48 p-3 border border-gray-300 rounded-md font-mono text-sm"
                            placeholder="Paste your markup here..."
                        />
                        {error && (
                            <p className="text-red-500 text-sm">{error}</p>
                        )}
                    </div>

                    {/* Preview and Download */}
                    {svgContent && (
                        <div className="space-y-4">
                            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between bg-white rounded-lg p-4 border border-gray-200 gap-4">
                                <div 
                                    className="w-32 h-32 flex items-center justify-center p-4 bg-gray-50 rounded border border-gray-100" 
                                    dangerouslySetInnerHTML={{ __html: svgContent }} 
                                />
                                
                                <div className="flex flex-col gap-2">
                                    <button
                                        onClick={handleDownload}
                                        className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"
                                    >
                                        <DownloadIcon />
                                        Download SVG
                                    </button>
                                    <div className="text-xs text-gray-500 font-mono">
                                        {svgContent.length} characters
                                    </div>
                                </div>
                            </div>
                            
                            {/* SVG Output */}
                            <div className="space-y-2">
                                <label className="block text-sm font-medium text-gray-700">
                                    Cleaned SVG Code:
                                </label>
                                <pre className="p-4 bg-gray-50 rounded-md text-xs text-gray-600 overflow-x-auto border border-gray-200">
                                    {svgContent}
                                </pre>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
